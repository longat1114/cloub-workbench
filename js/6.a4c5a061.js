(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{1100:function(t,n,e){},"43f5":function(t,n,e){"use strict";var i=e("f10a"),o=e.n(i);o.a},"4a0d":function(t,n,e){},"4b91":function(t,n,e){"use strict";var i=e("4a0d"),o=e.n(i);o.a},"4bfd":function(t,n,e){"use strict";e.d(n,"a",(function(){return i})),e.d(n,"b",(function(){return o})),e.d(n,"c",(function(){return r})),e.d(n,"d",(function(){return a}));e("7f7f");function i(t){this.name=t.id,this.label=t.caption,this.unit=t.unit,this.editor=t.editor,this.lookup=t.lookup,this.openwin=t.openwin,this.formControl=t.formControl}function o(t){this.selected=!1,this.id=t.id,this.mode=t.mode,this.preset=t.preset,this.pinned=t.pinned,this.content={name:t.name,desc:t.description,date:t.date}}function r(t,n){var e=this;this.operator=t,this.operand=n,this.type=null,this.value=[],this.mode=[],this.bool=function(){return e.type="boolean",e},this.int=function(){return e.type="integer",e},this.num=function(){return e.type="number",e},this.str=function(){return e.type="string",e},this.dt=function(){return e.type="datetime",e},this.addValue=function(t){return e.value.push(t),e.mode.push("value"),e},this.addField=function(t){return e.value.push(t),e.mode.push("field"),e}}function a(t){var n=this;this.condition=t,this.rules=[],this.add=function(t){if(t instanceof r)n.rules.push(t);else if(t instanceof a)n.rules.push(t);else if(t.rules){var e=new a(t.condition);t.rules.forEach(e.add),n.rules.push(e)}else{var i=new r(t.operator,t.operand);i.type=t.type,i.value=t.value,i.mode=t.mode,n.rules.push(i)}}}},"7c5c":function(t,n,e){"use strict";var i=e("a34a"),o=e.n(i);o.a},"85ed":function(t,n,e){"use strict";n["a"]={provide:function(){return{screen:this.showScreen}},methods:{showScreen:function(t,n){var e=t[0].toUpperCase()+t.slice(1),i="show".concat(e,"Screen");return this.vm[i](n)}}}},a34a:function(t,n,e){},bfad:function(t,n,e){"use strict";e.r(n);var i=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticStyle:{height:"100%"}},[e("dw-datatable",{attrs:{options:t.options,columns:t.columns,content:t.content}}),e("dw-datatable-aider"),e("dw-datatable-floating"),e("dw-datatable-actions",{staticClass:"dw-datatable-sticky absolute-top-right"})],1)},o=[],r=(e("7f7f"),e("d328")),a=e("85ed"),s=(e("7514"),e("551c"),e("06db"),e("2ef0")),c=e.n(s),u=e("2b0e"),l=e("e715"),d=e("bee1");function h(t){var n=new d["a"];n.add("description",(function(){return e.e(8).then(e.bind(null,"5ef4"))})).add("sorting",(function(){return e.e(10).then(e.bind(null,"07b8"))})).add("displaying",(function(){return e.e(9).then(e.bind(null,"89e3"))})).add("condition",(function(){return e.e(4).then(e.bind(null,"a682"))}));var i=n.dialog(t);return i}var f=function(){var t=function(t){this._screen=h(t)};return t.prototype={show:function(t,n){return this._screen.show(t,n)}},t}(),p=f,m=(e("8e6e"),e("8a81"),e("ac6a"),e("cadf"),e("456d"),e("c47a")),v=e.n(m);function w(t){this.description=t.description,this.style=t.style;var n={};n.prop=t.name,n.name=t.caption,n.visible=-1!==t.index,n.visibleIndex=t.index,n.width=t.width,n.frozenLeft=t.frozen,"text"!==t.editor&&(n.valueRenderer=t.editor),""!==t.format&&(n.valueFormat=t.format),"none"!==t.aggregation&&(n.aggregation=t.aggregation),"none"!==t.area&&(n.area=t.area),null!==t.lookup&&(n.lookup=t.lookup),this.column=n,this.menus=null}function b(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function g(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?b(Object(e),!0).forEach((function(n){v()(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):b(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var C=function(){var t=function(t){this._net=t};return t.prototype={config:function(t){var n=this;return this._getReportConfig(t).then((function(t){var e=t.group,i=t.fields,o=t.type,r=i.map((function(t){var n=t.name,i=new w(t),r=e.indexOf(n);return o===l["h"].grid&&(i.column.autoExpand=!1),i.column.groupIndex=r,i})),a=n._createViewOptions(t,r),s=n._createViewColumns(r),c={view:a,columns:s},u=t.id,d=t.name;return{id:u,name:d,presentation:o,columns:r,viewConfigs:c}}))},data:function(t,n){return this._getReportData(t,n)},_createViewOptions:function(t,n){var e=t.type,i={};if(i.presentation=e,i.formatRules=this._createColorRules(n),e===l["h"].tree){var o=c.a.find(n,["column.groupIndex",0]),r=c.a.find(n,["column.groupIndex",1]);o&&r&&(i.treeDataId=r.column.prop,i.treeDataParentId=o.column.prop)}return i},_createViewColumns:function(t){return t.map((function(t){return t.column}))},_createColorRules:function(t){var n=[];return t.forEach((function(t){t.style&&t.style.forEach((function(t){var e=new l["d"];e.value1=t.rule.value[0],e.value2=t.rule.value[1],e.condition=t.rule.operator;var i=l["a"].fromArray(t.color);t.applyToBack?e.appearance.backColor=i:e.appearance.foreColor=i;var o=new l["e"];o.rule=e,o.prop=t.rule.operand,o.applyToRow=t.applyToRow,n.push(o)}))})),n},_getReportConfig:function(t){return this._net.api("Report","GetReportConfig",t).then((function(t){return g({},t.content(),{fields:t.schema()})}))},_getReportData:function(t,n,e){var i=this._net.bind("Report","GetReportData").arguments(t);return e&&i.paging(e.begin,e.end),n&&i.where(n),i.api().then((function(t){return t.content()}))}},t}(),y=C,x=function(){var t=function(t){this._service=new y(t),this.id=null,this.name=null,this.presentation=null,this.columns=null};return t.prototype={initialize:function(t){var n=this;return this._service.config(t).then((function(t){return n.id=t.id,n.name=t.name,n.presentation=t.presentation,n.columns=t.columns,t.viewConfigs}))},load:function(t){return this._service.data(this.id,t)}},t}(),S=x,k=e("2395"),O=function(){var t=function(t){this._net=t};return t.prototype={getConditionForm:function(t){return this._net.api("Report","GetConditionForm",t).then((function(t){return t.schema()}))},getConditionHistory:function(t){return this._net.api("ReportPreferences","GetConditionHistory",t).then((function(t){return t.content()}))},getConditionCriteria:function(t,n,e){var i=this._net.bind("ReportPreferences","GetConditionCriteria").arguments(t);return i.content({id:e,mode:n}),i.api().then((function(t){return t.content().conditions}))},setConditionHistory:function(t,n,e,i,o,r,a,s){var c=this._net.bind("ReportPreferences","SetConditionHistory").arguments(t);return c.content({id:e,mode:n,name:r,description:a,preset:i,pinned:o}).where(s),c.api().then((function(t){return t.content()}))},setConditionState:function(t,n){var e=this._net.bind("ReportPreferences","SetConditionState").arguments(t);return e.content(n),e.api().then((function(t){return t.content()}))}},t}(),A=O;function j(t){var n=new d["a"];n.add("selection",(function(){return Promise.all([e.e(0),e.e(7)]).then(e.bind(null,"640a"))}));var i=n.dialog(t);return i}var P=function(){var t=function(t){this._screen=j(t)};return t.prototype={show:function(t,n){return this._screen.show(t,n)}},t}(),R=P,z=e("4bfd"),D=u["default"].extend({mixins:[k["a"],Object(r["a"])("$dw","dw-condition-context-vm")],static:function(){return{screen:null,backend:null}},data:function(){return{viewId:null,form:[],history:null,browsing:null,criteria:null}},watch:{browsing:function(){var t=this,n=this.browsing,e=n.mode,i=n.id;this.browsing.selected=!0,this.criteria=null,this.backend.getConditionCriteria(this.viewId,e,i).then((function(n){return t.criteria=n}))}},methods:{initialize:function(t){var n=this,e=this.$dw.net;return this.screen=new R(this),this.backend=new A(e),this.viewId=t,new Promise((function(e,i){n.backend.getConditionForm(t).then((function(t){n.form=t.map((function(t){return new z["a"](t)})),e()}))}))},alive:function(t){return this._loadHistory().then((function(){return t}))},containsConditions:function(){return 0<this.form.length},userCriteria:function(){return this.criteria},showSelectionScreen:function(t){var n=t.target,e=t.column,i=t.allowMultivalued,o=t.picked,r=this.$dw.net,a=new y(r),s=function(t){return a.config(t)},c=function(t){return a.data(t)};return this.screen.show("selection",{target:n,column:e,allowMultivalued:i,picked:o,tryReportConfig:s,tryReportData:c})},persist:function(t,n,e,i,o,r){var a=this,s=function(t){return a.criteria=r,t};return this.backend.setConditionHistory(this.viewId,n,t,e,!1,i,o,r).then(s)},onBookmarkChange:function(t,n,e){var i=this,o=[],r=function(t,n){o.push(v()({id:t.id,mode:t.mode},n,t[n]))};if("selected"!==n||e){if(("preset"===n||"selected"===n)&&e){var a=this.history.find((function(e){return e!==t&&e[n]}));a&&(a[n]=!1,"preset"===n&&r(a,n))}"selected"===n?this.browsing=t:(t[n]=e,r(t,n),this.backend.setConditionState(this.viewId,o).then((function(){return i._loadHistory()})))}},_loadHistory:function(){var t=this,n=function(n){t.history=n.map((function(t){return new z["b"](t)})),t._sortHistory();var e=null;e=null===t.browsing?_.find(t.history,"preset"):_.find(t.history,["id",t.browsing.id]),t.browsing=e||null};return this.history=null,this.backend.getConditionHistory(this.viewId).then(n)},_sortHistory:function(){this.history=_.orderBy(this.history,["preset","pinned","content.date"],["desc","desc","desc"])}}}),I=D,$=u["default"].extend({mixins:[Object(r["a"])("$dw","dw-report-instance-vm")],static:function(){return{viewApi:null,screen:null,context:null,conditionContext:null}},data:function(){return{ready:!1,total:0}},methods:{id:function(){return this.context.id},name:function(){return this.context.name},presentation:function(){return this.context.presentation},columns:function(){return this.context.columns},allColumns:function(){return this._translateColumns(this.viewApi.columns).sort((function(t,n){return t.visibleIndex-n.visibleIndex}))},visibleColumns:function(){return this._translateColumns(this.viewApi.visibleColumns)},initialize:function(t){var n=this,e=this.$dw.net,i=this.$parent;return this.screen=new p(i),this.context=new S(e),this.conditionContext=new I({parent:i}),new Promise((function(e,i){var o=!1,r=function(){n.context.initialize(t).then((function(t){o=!0,n._createViewOptions(t.view),e(t)}))};n.conditionContext.on("ok",(function(){o&&n.load()})),n.conditionContext.initialize(t).then((function(){n.conditionContext.containsConditions()?n.showConditionScreen().then((function(t){return t.onExit(r)})):r()}))}))},load:function(){var t=this,n=this.conditionContext.userCriteria();return this.viewApi.loading(!0),this.context.load(n).then((function(n){t.viewApi.setData(n),t.viewApi.loading(!1),t.total=n.length}))},expandAll:function(){this.viewApi.expandAll()},collapseAll:function(){this.viewApi.collapseAll()},containsGroupedColumns:function(){return this.presentation()===l["h"].tree||0<this.viewApi.groupedColumns.length},getDescription:function(){return Promise.resolve(this.visibleColumns())},getCustomizeSort:function(){var t=this.viewApi.sortedColumns.map((function(t){return{name:t.prop,mode:t.sortDirection}}));return Promise.resolve(t)},setCustomizeSort:function(t){var n=t.map((function(t){return{prop:t.name,mode:t.mode}}));return this.viewApi.sort(n),this.$emit("sorting-complete",t),Promise.resolve(t)},getCustomizeField:function(){return Promise.resolve([])},setCustomizeField:function(t){var n=this;if(this.presentation()===l["h"].pivot){var e=c.a.filter(t,{area:l["g"].rowArea,visible:!0}),i=c.a.filter(t,{area:l["g"].columnArea,visible:!0}),o=c.a.filter(t,{area:l["g"].dataArea,visible:!0});this.viewApi.setGroupColumns(e.map((function(t){return t.name}))),this.viewApi.setPivotColumns(i.map((function(t){return t.name}))),this.viewApi.setMeasureColumns(o.map((function(t){return t.name})))}else t.forEach((function(t){var e=t.index,i=t.visible,o=t.visible&&t.frozen;n.viewApi.setColumnVisible(t.name,i),n.viewApi.setColumnFrozen(t.name,o),n.viewApi.setColumnIndex(t.name,e)}));return Promise.resolve(t)},showDrilldownScreen:function(t,n,e){},showSortingScreen:function(){return this.screen.show("sorting",{datatableColumns:this.visibleColumns(),tryContent:this.getCustomizeSort,tryComplete:this.setCustomizeSort})},showDisplayingScreen:function(){return this.screen.show("displaying",{presentation:this.presentation(),datatableColumns:this.allColumns(),tryContent:this.getCustomizeField,tryComplete:this.setCustomizeField})},showDescriptionScreen:function(){this.screen.show("description",{tryContent:this.getDescription})},showConditionScreen:function(){return this.screen.show("condition",{context:this.conditionContext}).then(this.conditionContext.alive)},_createViewOptions:function(t){var n=this;return t.onGridReady=function(t){n.viewApi=t.api,n.load(),n.ready=!0},t},_translateColumns:function(t){var n=this,e=function(t){return c.a.find(n.columns(),"column.prop",t.prop)};return t.map((function(t){return{name:t.prop,caption:t.name,description:e(t).description,visible:t.visible,visibleIndex:t.visibleIndex,width:t.width,frozen:t.frozenLeft,aggregation:t.aggregation,area:t.area}}))}}}),E=$,H={count:"共{0}筆",button:{filter:"篩選",search:"搜尋",close:"關閉",next:"下一步",previous:"上一步",master:"分頁",detail:"分割",revert:"全部還原",cancel:"取消",save:"儲存",promise:"確定"},actions:{displaying:"編輯欄位",sorting:"內容排序",expanded:"全部展開",contracted:"全部收合",refresh:"重新整理",excel:"輸出Excel"},tooltip:{preset:"預設",pinned:"釘選",empty:"一鍵清除"},description:{title:"說明",keyword:"請輸入名稱或關鍵字",name:"名稱",description:"說明"},sorting:{title:"內容排序",allarea:"欄位名稱"},displaying:{title:"欄位編輯",allarea:"欄位名稱",rowarea:"行",columnarea:"欄",dataarea:"Σ值"},condition:{title:"篩選條件"},bookmark:{title:"歷史紀錄"},criterion:{title:"一般選項",name:"自訂條件名稱",desc:"說明"},selection:{step1:"篩選條件",step2:"已篩選條件",demo:{filtered:"品項編號",criteria:"包含",keyword:"00000",number:"共4筆"}}},F=H,G=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"dw-datatable-sticky fixed-top-right"},[e("dw-button",{staticClass:"dw-datatable-aider",attrs:{round:"",icon:"question"},on:{click:t.onShowScreen}})],1)},V=[],q={mixins:[Object(r["a"])("screen","dw-datatable-aider")],methods:{onShowScreen:function(){this.screen("description")}}},Q=q,B=(e("4b91"),e("2877")),T=e("eebe"),M=e.n(T),L=e("9c40"),J=Object(B["a"])(Q,G,V,!1,null,null,null),N=J.exports;M()(J,"components",{QBtn:L["a"]});var U=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"dw-datatable-sticky absolute-bottom-right"},[e("dw-button",{staticClass:"dw-datatable-floating",attrs:{round:"",icon:"filter"},on:{click:t.onShowScreen}})],1)},K=[],W={mixins:[Object(r["a"])("screen","dw-datatable-floating")],methods:{onShowScreen:function(){this.screen("condition")}}},X=W,Y=(e("43f5"),Object(B["a"])(X,U,K,!1,null,null,null)),Z=Y.exports;M()(Y,"components",{QBtn:L["a"]});var tt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"dw-datatable-actions",on:{touchend:t.onTouchend}},[e("dw-icon",{staticClass:"dw-datatable-action-icon",attrs:{"allow-click":"",name:"menu"}}),e("q-menu",{ref:"popup",attrs:{"content-class":"dw-datatable-actions-popup",anchor:"bottom right",self:"top right",offset:[0,-4]}},[e("q-list",{staticClass:"dw-datatable-actions-body"},[e("q-item",{staticClass:"dw-datatable-action dw-datatable-action-noicon dw-datatable-action-separator"},[e("q-item-section",{staticClass:"dw-datatable-action-content"},[e("dw-label",{staticClass:"dw-datatable-action-text",attrs:{value:t.total}})],1)],1),t._l(t.allowedActions,(function(t){return e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.name,staticClass:"dw-datatable-action",class:{"dw-datatable-action-separator":t.separator},attrs:{clickable:""},on:{click:t.action}},[e("q-item-section",{staticClass:"dw-datatable-action-content"},[e("dw-icon",{staticClass:"dw-datatable-action-icon",attrs:{name:t.icon}}),e("dw-label",{staticClass:"dw-datatable-action-text",attrs:{value:t.text}})],1)],1)}))],2)],1)],1)},nt=[],et=u["default"].extend({mixins:[Object(r["a"])("_t","dw-datatable-actions"),Object(r["a"])("vm","dw-datatable-actions"),Object(r["a"])("screen","dw-datatable-actions")],computed:{actions:function(){return[{name:"displaying",text:this._t.actions.displaying,icon:"edit",action:this.showDisplayingScreen},{name:"sorting",text:this._t.actions.sorting,icon:"sortby",action:this.showSortingScreen},{name:"expanded",text:this._t.actions.expanded,icon:"all-expand",action:this.expand},{name:"contracted",text:this._t.actions.contracted,icon:"all-collapse",action:this.collapse,separator:!0},{name:"refresh",text:this._t.actions.refresh,icon:"refresh",action:this.refresh}]},allowedActions:function(){return this.vm.ready?this.vm.containsGroupedColumns()?this.actions:this.actions.filter((function(t){return!("expanded"===t.name||"contracted"===t.name)})):[]},total:function(){return String.format(this._t.count,this.vm.total)}},methods:{showDisplayingScreen:function(){this.screen("displaying")},showSortingScreen:function(){this.screen("sorting")},expand:function(){this.vm.expandAll()},collapse:function(){this.vm.collapseAll()},refresh:function(){this.vm.load()},dummy:function(){},onTouchend:function(){this.$refs.popup.toggle()}}}),it=et,ot=(e("fd47"),e("4e73")),rt=e("1c1c"),at=e("66e5"),st=e("4074"),ct=e("7f67"),ut=Object(B["a"])(it,tt,nt,!1,null,null,null),lt=ut.exports;M()(ut,"components",{QMenu:ot["a"],QList:rt["a"],QItem:at["a"],QItemSection:st["a"]}),M()(ut,"directives",{ClosePopup:ct["a"]});var dt={components:{"dw-datatable-aider":N,"dw-datatable-actions":lt,"dw-datatable-floating":Z},mixins:[a["a"],Object(r["a"])("$dw","dw-data-report")],provide:function(){return{_t:F,vm:this.vm}},static:function(){return{vm:null}},data:function(){return{options:void 0,columns:void 0,content:[]}},beforeCreate:function(){var t=this;this.vm=new E({parent:t})},mounted:function(){var t=this,n=this.$dw.application,e=n.context.browsing.name;this.vm.initialize(e).then((function(n){t.options=n.view,t.columns=n.columns}))}},ht=dt,ft=(e("7c5c"),Object(B["a"])(ht,i,o,!1,null,null,null)),pt=ft.exports;n["default"]=pt},d328:function(t,n,e){"use strict";var i=function(t,n){var e={};return e[t]={default:function(){console.error("[".concat(n,"] needs a provider called [").concat(t,"]."))}},{inject:e}};n["a"]=i},f10a:function(t,n,e){},fd47:function(t,n,e){"use strict";var i=e("1100"),o=e.n(i);o.a}}]);